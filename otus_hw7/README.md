otus_hw7 Загрузка системы

1. Попадаем в систему без пароля разными способами

Через редактирование в grub при загрузке, для чего в Vagrantfile добавляем
vb.gui = true
Так как загрузка происходит очень быстро, увеличиваем таймаут в grub для того, чтобы успеть нажать "e":
Правим /etc/default/grub , делаем GRUB_TIMEOUT 15, затем применяем измененный файл
 grub2-mkconfig  -o /boot/grub2/grub.cfg
A. init=/bin/sh (Не работает у меня на centos7 в VM)
	В конце строки начинающейся с linux16 добавляем init=/bin/sh и нажимаем сtrl-x для
загрузки в систему
	В целом на этом все, Мы попали в систему. Но есть один ньюанс. Рутовая файловая
система при этом монтируется в режиме Read-Only. Если вы хотите перемонтировать ее в
режим Read-Write можно воспользоваться командой:
	mount -o remount,rw /
 По факту в Centos 7 ловим kernel panic вместо загрузки

B.  rd.break (Не работает у меня на centos7 в VM)
	В конце строки начинающейся с linux16 добавляем rd.break и нажимаем сtrl-x для
загрузки в систему
	По факту получаем обычное приглашение для авторизации.
C. rw init=/sysroot/bin/sh (Не работает у меня на centos7 в VM)
	В  строке начинающейся с linux16 меняем "ro" на "rw init=/sysroot/bin/sh" и нажимаем сtrl-x для
загрузки в систему
По факту при загрузке встает колом, не грузится, но и ошибок нет.

В то же время, тестируя на живой системе, а не на VM у меня получалось войти без пароля, использовал это в своей практике.

2. Установить систему с LVM, после чего переименовать VG.

переименовываем Volume Group
vgrename VolGroup00 OtusRoot
правим /etc/fstab/ /etc/default/grub, /boot/grub2/grub.cfg заменяя старое название на новое
пересоздаем initrd image mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
Перезагружаемся, после перезагрузки при помощи vgs убеждаемся, что переименование VG прошло успешно.

3. Запилить пингвина в загрузку ядра.

Устанавливаем свой модуль в  /usr/lib/dracut/modules.d/01test
Пересобираем образ dracut -f -v
Проверяем, какие модули добавлены в ядро
lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
После перезагрузки видно пингвина при старте системы.
